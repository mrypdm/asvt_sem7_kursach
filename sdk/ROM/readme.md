# Устройство внешней постоянной памяти

## Инициализация

При инициализации создает файл `memory.bin` размером 65536 байт, устанавливает бит готовности и возвращает один из следующих кодов:

| Код возврата | Описание            |
|--------------|---------------------|
| 0            | Нет ошибок          |
| 1            | Ошибка ввода-вывода |
| 2            | Ошибка доступа      |
| 255          | Неизвестная ошибка  |

Устройство работает с 16-битными словами, каждое из которых имеет четный адрес.

## Адреса регистров

Адрес буферного регистра: 0o177000

Адрес регистра управления: 0o177002

Адрес вектора прерывания: 0o000060

## Формат регистра управления:

| 15-12      | 11            | 10-8            | 7              | 6                         | 5-1         | 0                     |
|------------|---------------|-----------------|----------------|---------------------------|-------------|-----------------------|
| код ошибки | бит занятости | не используется | бит готовности | бит разрешения прерываний | код функции | бит разрешения работы |

| Код функции | Описание                  |
|-------------|---------------------------|
| 00000       | Нет функции               |
| 00001       | Чтение адреса             |
| 00010       | Запись значения по адресу |
| 00011       | Установить адрес          |
| 00100       | Установить значение       |

| Код ошибки | Описание                  |
|------------|---------------------------|
| 0000       | Нет ошибок                |
| 0001       | Нечетный адрес            |
| 0010       | Неверный код функции      |
| 0011       | Не предоставлен адрес     |
| 0100       | Не предоставлено значение |

## Описание работы

Для работы с устройством необходимо установить бит разрешения работы.

При необходимости можно установить бит разрешения прерываний,
тогда при установке устройством бита готовности, будет генерироваться прерывание.

Для чтения данных нужно:

1. Записать адрес в буфер
2. Установить код функции 0011
3. Установить код функции 0001
4. Прочитать значение из буфера

Для записи данных нужно:

1. Записать адрес в буфер
2. Установить код функции 0011
3. Записать значение в буфер
4. Установить код функции 0100
5. Установить код функции 0010